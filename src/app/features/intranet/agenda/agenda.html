<div class="agenda-container">
  <!-- Header -->
  <div class="agenda-header">
    <div class="header-left">
      <button mat-icon-button class="nav-button" (click)="previousWeek()">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <button mat-stroked-button class="today-button" (click)="goToToday()">
        Hoy
      </button>

      <button mat-icon-button class="nav-button" (click)="nextWeek()">
        <mat-icon>chevron_right</mat-icon>
      </button>

      <div class="date-range">
        <span class="range-text">{{ getWeekRange() }}</span>
      </div>
    </div>

    <div class="header-right">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Estado</mat-label>
        <mat-select [(ngModel)]="selectedStatus" (selectionChange)="onStatusFilterChange()">
          <mat-option *ngFor="let status of statusOptions" [value]="status.value">
            {{ status.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-flat-button class="view-mode-button">
        <mat-icon>view_week</mat-icon>
        Por semana
      </button>

      <button mat-icon-button [matMenuTriggerFor]="settingsMenu" class="settings-button">
        <mat-icon>settings</mat-icon>
      </button>

      <mat-menu #settingsMenu="matMenu">
        <div class="menu-content" (click)="$event.stopPropagation()">
          <div class="menu-header">Configuraci√≥n</div>
          <div class="menu-item">Vista</div>
        </div>
      </mat-menu>

      <button mat-icon-button class="more-button">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>

  <!-- Doctor Filters Sidebar -->
  <div class="content-wrapper">

    <!-- Calendar Grid -->
    <div class="calendar-wrapper">
      <ng-template #eventTemplate let-weekEvent="weekEvent" let-locale="locale">
        <div class="custom-event-card"
             [style.border-left-color]="getStatusColor(weekEvent.event.meta.appointment.estado)"
             (click)="handleEventClick(weekEvent.event)">
          <div class="event-title">
            <strong>{{ weekEvent.event.title }}</strong>
          </div>
          <div class="event-subtitle">
            {{ weekEvent.event.meta.appointment.motivo }}
          </div>
        </div>
      </ng-template>

      <mwl-calendar-week-view
        [viewDate]="viewDate"
        [events]="events"
        [refresh]="refresh"
        [locale]="'es'"
        [dayStartHour]="8"
        [dayEndHour]="20"
        [eventTemplate]="eventTemplate"
        (eventClicked)="handleEventClick($event.event)">
      </mwl-calendar-week-view>
    </div>


    <div class="doctors-sidebar">
      <div class="sidebar-header">
        <mat-icon class="sidebar-icon">filter_list</mat-icon>
        <span>Todas las agendas</span>
      </div>

      <div class="doctors-list">
        <div
          *ngFor="let doctor of doctors"
          class="doctor-item"
          [class.active]="selectedDoctors.includes(doctor.id)"
          (click)="toggleDoctorFilter(doctor.id)"
        >
          <div class="doctor-avatar" [style.background-color]="doctor.color">
            <mat-icon>person</mat-icon>
          </div>
          <div class="doctor-info">
            <span class="doctor-name">{{ doctor.nombre }} {{ doctor.apellido }}</span>
          </div>
          <button mat-icon-button class="doctor-menu-button" (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>
        </div>

        <button mat-button class="add-doctor-button">
          <mat-icon>add</mat-icon>
          Agregar
        </button>
      </div>
    </div>
  </div>
</div>
