<div class="dialog-container">
  <button class="absolute-close" (click)="close()">
    <mat-icon>close</mat-icon>
  </button>

  <mat-tab-group animationDuration="0ms" class="appointment-tabs">
    <mat-tab label="Datos de la cita">
      <div class="main-content">

        <div class="content-column">
          <div class="row-field">
            <span class="row-label">Sucursal</span>
            <div class="row-value static-text">
              <mat-icon class="icon-teal">location_on</mat-icon>
              <span>{{ data.appointment.branch }}</span>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Paciente</span>
            <div class="row-value static-text bold">
              <span class="patient-name-link">
                {{ data.appointment.patientId }}
              </span>
              <button mat-icon-button class="view-patient-btn" (click)="viewPatient()" matTooltip="Ver ficha del paciente">
                <mat-icon>visibility</mat-icon>
              </button>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Doctor</span>
            <div class="row-value">
              <mat-form-field appearance="outline">
                <mat-select [(ngModel)]="data.appointment.doctorId">
                  <mat-option *ngFor="let doc of doctors" [value]="doc.id">
                    {{ doc.nombre }} {{ doc.apellido }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Especialidad</span>
            <div class="row-value static-text bold">
              {{ data.appointment.specialty || 'Odontología general' }}
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Motivo</span>
            <div class="row-value">
              <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="data.appointment.reason">
              </mat-form-field>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Duración</span>
            <div class="row-value">
              <mat-form-field appearance="outline" subscriptSizing="dynamic">
                <mat-select [(ngModel)]="data.appointment.duration">
                  <mat-option *ngFor="let opt of durationOptions" [value]="opt.value">
                    {{ opt.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Estado:</span>
            <div class="row-value">
              <mat-form-field appearance="outline" [ngClass]="data.appointment.status.toLowerCase()">
                <mat-select [(ngModel)]="data.appointment.status">
                  <mat-option *ngFor="let st of statuses" [value]="st.value">
                    {{ st.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>

        <div class="vertical-separator"></div>

        <div class="content-column">
          <div class="row-field">
            <span class="row-label">Fecha</span>
            <div class="row-value">
              <mat-form-field appearance="outline">
                <input matInput [matDatepicker]="picker" [(ngModel)]="data.appointment.date">
                <mat-datepicker-toggle matIconSuffix [for]="picker">
                  <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>

          <div class="row-field">
            <span class="row-label">Hora inicio</span>
            <div class="row-value">
              <div class="custom-time-picker">
                <input
                  type="number"
                  class="time-input"
                  placeholder="HH"
                  min="1"
                  max="12"
                  [(ngModel)]="timeValues.hour"
                  (input)="validateTimeInput('hour')"
                  (blur)="ensureValidTime('hour')">

                <span class="time-separator">:</span>

                <input
                  type="number"
                  class="time-input"
                  placeholder="MM"
                  min="0"
                  max="59"
                  [(ngModel)]="timeValues.minute"
                  (input)="validateTimeInput('minute')"
                  (blur)="ensureValidTime('minute')">

                <mat-form-field appearance="outline" class="period-select" subscriptSizing="dynamic">
                  <mat-select [(ngModel)]="timeValues.period" (selectionChange)="formatTime()">
                    <mat-option value="AM">AM</mat-option>
                    <mat-option value="PM">PM</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="optional-block">
            <h4 class="block-title">Opcional</h4>
            <div class="row-field">
              <span class="row-label">
                Consultorio <mat-icon class="icon-info">info_outline</mat-icon>
              </span>
              <div class="row-value">
                <mat-form-field appearance="outline">
                  <mat-select placeholder="Seleccionar">
                    <mat-option value="1">Consultorio 1</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="notes-full-width">
            <span class="notes-label">Nota de la cita</span>
            <mat-form-field appearance="outline" class="text-area-field">
              <textarea matInput rows="5" placeholder="Escribe aquí..."></textarea>
            </mat-form-field>
          </div>
        </div>

      </div>
    </mat-tab>

    <mat-tab label="Historial de cambios">
      <div class="empty-history-state">
        <mat-icon>cloud_queue</mat-icon>
        <p>No se encontró ninguna información</p>
      </div>
    </mat-tab>
  </mat-tab-group>

  <div class="dialog-footer">
    <button mat-stroked-button class="delete-action" (click)="onDelete()">Eliminar cita</button>
    <div class="flex-spacer"></div>
    <button mat-button class="cancel-action" (click)="close()">Cancelar</button>
    <button mat-flat-button class="save-action" (click)="onSave()">Guardar</button>
  </div>
</div>
